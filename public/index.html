<!doctype html>
<html lang="es-AR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voltri</title>
  <meta name="theme-color" content="#0f0f0f" />
  <style>
    :root{
      --bg:#0f0f0f; --text:#f2f2f2; --muted:#b8b8b8;
      --accent:#d7b07a; --ok:#42d37a; --bad:#ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,35);
      --r:18px;
      --promoH: 46px;
      --headerH: 70px;
    }
    html{scroll-behavior:smooth; scroll-padding-top: calc(var(--headerH) + var(--promoH));}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background: radial-gradient(1200px 700px at 20% -10%, rgba(215,176,122,.25), transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, rgba(66,211,122,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .promo{
      position:sticky; top:0; z-index:30;
      background: rgba(215,176,122,.14);
      border-bottom:1px solid rgba(215,176,122,.22);
      backdrop-filter: blur(10px);
      display:none;
    }
    .promo .wrap{
      padding: 10px 22px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      min-height: var(--promoH);
    }
    .promoTxt{font-weight:800;color:#f0d2a5;letter-spacing:.01em;font-size:14px}
    .promoTxt span{color:var(--text);font-weight:700}
    .topbar{
      position:sticky; top: var(--promoH); z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(15,15,15,.65);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .topbar .wrap{display:flex;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    a.logo{
      width:48px;height:48px;border-radius:12px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;text-decoration:none;flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover;border-radius:12px;display:block}
    .logo .fallback{
      width:100%;height:100%; border-radius:12px; display:none;
      align-items:center;justify-content:center;font-weight:900;letter-spacing:.04em;
      color: var(--text); background: rgba(255,255,255,.06);
    }
    .logo.is-fallback img{display:none}
    .logo.is-fallback .fallback{display:flex}
    nav{margin-left:auto;display:flex;gap:14px;flex-wrap:wrap}
    nav a{
      text-decoration:none;color:var(--muted);
      font-size:14px;padding:8px 10px;border-radius:12px;
      transition:.2s ease;
    }
    nav a:hover{color:var(--text);background:rgba(255,255,255,.06)}
    .cta{display:flex;gap:10px;align-items:center;margin-left:6px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      gap:10px;padding:10px 14px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      text-decoration:none;font-weight:650;font-size:14px;
      transition:.2s ease;white-space:nowrap;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.09)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(66,211,122,.95), rgba(66,211,122,.25));
      color:#0b1510;border-color: rgba(66,211,122,.35);
      font-weight:850;
    }
    .hero{padding:34px 0 10px}
    .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:18px;align-items:stretch}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}.brand{min-width:auto}nav{display:none}}
    .card{
      background: rgba(22,22,22,.78);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:18px;
    }
    h1{margin:0 0 10px;font-size:42px;letter-spacing:-.02em}
    @media (max-width: 520px){ h1{font-size:34px} }
    .sub{color:var(--muted);font-size:16px;margin:0 0 16px}
    .pillrow{display:flex;gap:10px;flex-wrap:wrap;margin:14px 0 0}
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:8px 10px;border-radius:999px;font-size:13px;
    }
    .pill .dot{display:inline-block;width:8px;height:8px;border-radius:99px;background:var(--accent);margin-right:8px;vertical-align:middle}
    .pill.ok .dot{background:var(--ok)}
    section{padding:14px 0}
    h2{margin:0 0 10px;font-size:24px}
    .muted{color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .kv{display:flex;gap:10px;justify-content:space-between;align-items:flex-start;margin:10px 0}
    .kv .k{color:var(--muted);font-size:13px}
    .kv .v{font-weight:850;text-align:right}
    .menuGrid{display:grid;grid-template-columns: 1fr 1fr 1fr;gap:12px;margin-top:8px}
    @media (max-width: 900px){ .menuGrid{grid-template-columns:1fr} }
    .menuBox{border:1px solid rgba(255,255,255,.08);background: rgba(255,255,255,.04);border-radius:16px;padding:14px}
    .menuBox h3{margin:0 0 10px;font-size:16px}
    .menuItem{display:flex;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.06)}
    .menuItem:last-child{border-bottom:none}
    .menuItem .name{font-weight:700}
    .menuItem .desc{color:var(--muted);font-size:12px;margin-top:3px}
    .menuItem .price{font-weight:900;white-space:nowrap}
    .steps{display:grid;grid-template-columns: repeat(3, 1fr);gap:12px;margin-top:10px}
    @media (max-width: 900px){ .steps{grid-template-columns:1fr} }
    .step{border:1px solid rgba(255,255,255,.08);background: rgba(255,255,255,.04);border-radius: 16px;padding:14px}
    .stepNum{width:34px;height:34px;border-radius:12px;display:grid;place-items:center;background: rgba(215,176,122,.14);border:1px solid rgba(215,176,122,.22);color:#f0d2a5;font-weight:900;margin-bottom:10px}
    .step h3{margin:0 0 6px;font-size:16px}
    .step p{margin:0;color:var(--muted);font-size:13px}
    .reviews{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width: 900px){ .reviews{grid-template-columns:1fr} }
    .review{border:1px solid rgba(255,255,255,.08);background: rgba(255,255,255,.04);border-radius:16px;padding:14px}
    .review .who{display:flex;justify-content:space-between;gap:10px;margin-bottom:10px;align-items:flex-start}
    .stars{color:var(--accent);font-weight:900;letter-spacing:.03em;white-space:nowrap}
    .meta{font-size:12px;color:var(--muted);margin-top:2px}
    .mapframe{width:100%;height:340px;border:0;border-radius:16px;background:#101010}
    footer{padding:24px 0 80px}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:18px 0}
    .floatbar{position:fixed;left:0;right:0;bottom:0;display:none;gap:10px;padding:12px;background: rgba(15,15,15,.75);backdrop-filter: blur(10px);border-top:1px solid rgba(255,255,255,.08);z-index:50}
    .floatbar .btn{flex:1}
    @media (max-width: 900px){ .floatbar{display:flex} }
  </style>
</head>
<body>
  <div class="promo" id="promo">
    <div class="wrap">
      <div class="promoTxt"><span id="promoLabel">Promo</span>: <span id="promoText"></span></div>
      <a class="btn" id="promoBtn" target="_blank" rel="noopener">Escribinos</a>
    </div>
  </div>

  <header class="topbar">
    <div class="wrap">
      <div class="brand">
        <a class="logo" href="#" aria-label="Inicio" id="logo">
          <img src="logo.jpg" alt="Logo" onerror="this.closest('.logo').classList.add('is-fallback')" />
          <span class="fallback" id="logoFallback">VOLTRI</span>
        </a>
        <div>
          <div class="small" id="tagline">☕ Café de especialidad</div>
          <div style="font-weight:950" id="businessName">Voltri</div>
        </div>
      </div>

      <nav>
        <a href="#info">Info</a>
        <a href="#menu">Carta</a>
        <a href="#como-pedir">Cómo pedir</a>
        <a href="#faq">FAQ</a>
        <a href="#ubicacion">Ubicación</a>
      </nav>

      <div class="cta">
        <a class="btn" href="indexMenu.html">Carta rápida</a>
        <a class="btn primary" id="waTop" target="_blank" rel="noopener">WhatsApp</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="inicio">
      <div class="grid">
        <div class="card">
          <h1 id="heroTitle">Café de especialidad</h1>
          <p class="sub" id="heroSubtitle">Desayunos, meriendas y algo rico para acompañar.</p>

          <div class="pillrow">
            <div class="pill ok" id="openPill"><span class="dot"></span><span id="openText">Cargando horario…</span></div>
            <div class="pill"><span class="dot"></span><span id="addrPill">San Martín 780, Quilmes</span></div>
          </div>

          <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn primary" id="waHero" target="_blank" rel="noopener">Consultar por WhatsApp</a>
            <a class="btn" id="mapsHero" target="_blank" rel="noopener">Cómo llegar</a>
            <a class="btn" id="igHero" target="_blank" rel="noopener">Instagram</a>
          </div>
        </div>

        <div class="card" id="info">
          <h2>Info</h2>
          <div class="kv"><div class="k">Dirección</div><div class="v" id="addrInfo">—</div></div>
          <div class="kv"><div class="k">Horarios</div><div class="v" id="hoursInfo">—</div></div>
          <div class="kv"><div class="k">Pagos</div><div class="v" id="paymentsInfo">—</div></div>
          <div class="kv"><div class="k">WhatsApp</div><div class="v" id="phoneInfo">—</div></div>
        </div>
      </div>
    </section>

    <section id="menu">
      <h2>Carta</h2>
      <div class="muted">Se actualiza desde <code>products.json</code> (admin).</div>
      <div class="menuGrid" id="menuGrid"></div>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn primary" href="indexMenu.html">Abrir carta rápida</a>
      </div>
    </section>

    <section id="como-pedir">
      <h2>Cómo pedir</h2>
      <div class="steps" id="steps"></div>
    </section>

    <section id="faq">
      <h2>Preguntas frecuentes</h2>
      <div class="card" id="faqBox"></div>
    </section>

    <section id="reseñas">
      <h2>Reseñas</h2>
      <div class="reviews" id="reviews"></div>
    </section>

    <section id="ubicacion">
      <h2>Ubicación</h2>
      <iframe class="mapframe" id="mapframe" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </section>

    <footer>
      <div class="hr"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between">
        <div>© <span id="y"></span> <span id="footerName">Voltri</span></div>
        <div class="small"><span id="footerAddr">—</span> · WhatsApp: <span id="footerPhone">—</span> · <a id="footerIg" target="_blank" rel="noopener">Instagram</a></div>
      </div>
    </footer>
  </main>

  <div class="floatbar">
    <a class="btn primary" id="waFloat" target="_blank" rel="noopener">WhatsApp</a>
    <a class="btn" id="mapsFloat" target="_blank" rel="noopener">Cómo llegar</a>
  </div>

<script>
  const y = document.getElementById("y");
  y.textContent = new Date().getFullYear();

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function hmToMin(hm){
    const [h,m] = hm.split(":").map(Number);
    return h*60 + m;
  }
  function getBuenosAiresNow(tz){
    const parts = new Intl.DateTimeFormat("es-AR", {
      timeZone: tz || "America/Argentina/Buenos_Aires",
      weekday: "short",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    }).formatToParts(new Date());

    let weekday = "", hour = "00", minute = "00";
    for(const p of parts){
      if(p.type === "weekday") weekday = p.value.toLowerCase();
      if(p.type === "hour") hour = p.value;
      if(p.type === "minute") minute = p.value;
    }
    return { weekday, minutes: (parseInt(hour,10)*60 + parseInt(minute,10)) };
  }
  function weekdayToNum(w){
    // es-AR: lun, mar, mié, jue, vie, sáb, dom
    w = (w||"").toLowerCase();
    if(w.startsWith("lun")) return 1;
    if(w.startsWith("mar")) return 2;
    if(w.startsWith("mi")) return 3;
    if(w.startsWith("jue")) return 4;
    if(w.startsWith("vie")) return 5;
    if(w.startsWith("sá") || w.startsWith("sa")) return 6;
    return 0; // dom
  }
  function computeOpenNow(site){
    const tz = site?.hours?.timezone || "America/Argentina/Buenos_Aires";
    const schedule = site?.hours?.schedule || {};
    const now = getBuenosAiresNow(tz);
    const dayNum = weekdayToNum(now.weekday);
    const ranges = schedule[String(dayNum)] || [];
    for(const r of ranges){
      const start = hmToMin(r[0]);
      const end = hmToMin(r[1]);
      if(now.minutes >= start && now.minutes < end) return true;
    }
    return false;
  }

  async function loadSite(){
    const res = await fetch("/site.json", { cache: "no-store" });
    const site = await res.json();

    document.title = site?.seo?.title || document.title;
    const theme = document.querySelector('meta[name="theme-color"]');
    if(theme && site?.seo?.themeColor) theme.setAttribute("content", site.seo.themeColor);

    document.getElementById("businessName").textContent = site.businessName || "Voltri";
    document.getElementById("footerName").textContent = site.businessName || "Voltri";
    document.getElementById("logoFallback").textContent = (site.businessName || "Voltri").toUpperCase().slice(0,8);
    document.getElementById("tagline").textContent = site.tagline || "";

    document.getElementById("heroTitle").textContent = site.heroTitle || "";
    document.getElementById("heroSubtitle").textContent = site.heroSubtitle || "";

    const addr = site?.location?.addressText || "";
    document.getElementById("addrPill").textContent = addr;
    document.getElementById("addrInfo").textContent = addr;
    document.getElementById("footerAddr").textContent = addr;

    const hours = site?.hours?.summary || "";
    document.getElementById("hoursInfo").textContent = hours;

    document.getElementById("paymentsInfo").textContent = site.payments || "";
    document.getElementById("phoneInfo").textContent = site?.contact?.phoneDisplay || "";
    document.getElementById("footerPhone").textContent = site?.contact?.phoneDisplay || "";

    const ig = site?.contact?.instagramUrl || "#";
    const igHero = document.getElementById("igHero");
    igHero.href = ig;
    document.getElementById("footerIg").href = ig;

    const waNum = site?.contact?.whatsappNumber || "";
    const waMsg = site?.promo?.waMessage || ("Hola "+(site.businessName||"") + "!");
    const waUrl = "https://wa.me/"+encodeURIComponent(waNum)+"?text="+encodeURIComponent(waMsg);

    for(const id of ["waTop","waHero","waFloat","promoBtn"]){
      const a = document.getElementById(id);
      if(a) a.href = waUrl;
    }

    const mq = site?.location?.mapsQuery || addr;
    const mapsUrl = "https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(mq);
    for(const id of ["mapsHero","mapsFloat"]){
      const a = document.getElementById(id);
      if(a) a.href = mapsUrl;
    }

    // promo
    if(site?.promo?.enabled){
      document.getElementById("promoLabel").textContent = site.promo.label || "Promo";
      document.getElementById("promoText").textContent = site.promo.text || "";
      document.getElementById("promoBtn").textContent = site.promo.buttonText || "Escribinos";
      document.getElementById("promo").style.display = "block";
    }

    // open/closed
    const isOpen = computeOpenNow(site);
    document.getElementById("openText").textContent = isOpen ? "Abierto ahora" : "Cerrado ahora";

    // steps
    const steps = document.getElementById("steps");
    steps.innerHTML = (site.howToOrder || []).slice(0,3).map((s,i)=>`
      <div class="step">
        <div class="stepNum">${i+1}</div>
        <h3>${escapeHtml(s.title||"")}</h3>
        <p>${escapeHtml(s.text||"")}</p>
      </div>`).join("");

    // faq
    const faq = document.getElementById("faqBox");
    faq.innerHTML = (site.faq || []).map(x=>`
      <div style="margin:10px 0">
        <div style="font-weight:900">${escapeHtml(x.q||"")}</div>
        <div class="small" style="margin-top:4px">${escapeHtml(x.a||"")}</div>
      </div>`).join("") || "<div class='small'>Sin FAQ por ahora.</div>";

    // reviews
    const reviews = document.getElementById("reviews");
    reviews.innerHTML = (site.reviews || []).map(r=>{
      const stars = "★★★★★".slice(0, Math.max(0, Math.min(5, Number(r.stars||0))));
      return `
      <div class="review">
        <div class="who">
          <div>
            <div style="font-weight:900">${escapeHtml(r.name||"")}</div>
            <div class="meta">${escapeHtml(r.meta||"")}</div>
          </div>
          <div class="stars">${stars}</div>
        </div>
        <div class="small">${escapeHtml(r.text||"")}</div>
      </div>`;
    }).join("");

    // map iframe
    const map = document.getElementById("mapframe");
    map.src = "https://www.google.com/maps?q="+encodeURIComponent(mq)+"&output=embed";
  }

  async function loadMenu(){
    const grid = document.getElementById("menuGrid");
    try{
      const res = await fetch("/products.json", { cache: "no-store" });
      const data = await res.json();
      const cats = Array.isArray(data.categories) ? data.categories : [];
      grid.innerHTML = cats.map(cat => {
        const items = (cat.items || []).slice(0,5).map(it => `
          <div class="menuItem">
            <div>
              <div class="name">${escapeHtml(it.name||"")}</div>
              <div class="desc">${escapeHtml(it.description||"")}</div>
            </div>
            <div class="price">${escapeHtml(it.price||"")}</div>
          </div>
        `).join("");
        return `<div class="menuBox"><h3>${escapeHtml(cat.category||"")}</h3>${items}</div>`;
      }).join("");
    }catch(e){
      grid.innerHTML = "<div class='small'>No se pudo cargar la carta.</div>";
    }
  }

  (async function init(){
    try{ await loadSite(); }catch(_e){}
    await loadMenu();
  })();
</script>
</body>
</html>
