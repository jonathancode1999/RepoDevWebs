<!doctype html>
<html lang="es-AR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin · Sitio completo</title>

<style>
:root{
  --bg:#0f0f0f;
  --card:#171717;
  --border:#2a2a2a;
  --text:#f2f2f2;
  --muted:#b8b8b8;
  --accent:#42d37a;
  --danger:#ff6b6b;
  --radius:14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
h1{margin:0 0 4px}
h2{margin:24px 0 10px;font-size:18px}
.small{font-size:12px;color:var(--muted)}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:16px;
}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

label{display:block;font-size:12px;color:var(--muted);margin-top:10px}
input,textarea{
  width:100%;
  padding:10px;
  margin-top:4px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0b0b0b;
  color:var(--text);
}
textarea{resize:vertical}

button{
  padding:12px 16px;
  border-radius:12px;
  border:0;
  font-weight:900;
  cursor:pointer;
}
.primary{background:var(--accent);color:#042013}
.secondary{background:#2b2b2b;color:var(--text)}
.status{margin-left:12px;font-size:13px}
.ok{color:var(--accent)}
.bad{color:var(--danger)}

.list textarea{min-height:120px;font-family:monospace}
hr{border:0;border-top:1px solid var(--border);margin:16px 0}
</style>
</head>

<body>
<div class="wrap">
  <h1>Admin · Sitio</h1>
  <div class="small">Editá todo el contenido del sitio sin tocar JSON.</div>

  <!-- TOKEN -->
  <div class="card">
    <label>Token de administrador</label>
    <input id="token" type="password" placeholder="Bearer token">
  </div>

  <!-- DATOS PRINCIPALES -->
  <div class="card">
    <h2>Datos del negocio</h2>
    <div class="grid">
      <div>
        <label>Nombre</label>
        <input id="businessName">
      </div>
      <div>
        <label>Tagline</label>
        <input id="tagline">
      </div>
    </div>

    <label>Título principal</label>
    <input id="heroTitle">

    <label>Subtítulo (puede tener saltos de línea)</label>
    <textarea id="heroSubtitle"></textarea>
  </div>

  <!-- CONTACTO -->
  <div class="card">
    <h2>Contacto</h2>
    <div class="grid">
      <div>
        <label>WhatsApp (E164)</label>
        <input id="whatsapp">
      </div>
      <div>
        <label>Teléfono visible</label>
        <input id="phoneDisplay">
      </div>
    </div>
    <label>Instagram URL</label>
    <input id="instagramUrl">
  </div>

  <!-- UBICACIÓN -->
  <div class="card">
    <h2>Ubicación</h2>
    <label>Dirección</label>
    <input id="addressLine">

    <label>Google Maps Embed URL</label>
    <input id="mapsEmbedUrl">

    <label>Google Maps Link</label>
    <input id="mapsLinkUrl">
  </div>

  <!-- HORARIOS -->
  <div class="card">
    <h2>Horarios</h2>
    <label>Resumen</label>
    <input id="hoursSummary">

    <label>Detalle (uno por línea)</label>
    <textarea id="hoursLines" placeholder="Lunes a Viernes|08:00 – 20:00"></textarea>
  </div>

  <!-- PRECIO -->
  <div class="card">
    <h2>Precio estimado</h2>
    <input id="priceRangeLine" placeholder="$$ – $$$">
  </div>

  <!-- RESEÑAS -->
  <div class="card list">
    <h2>Reseñas</h2>
    <div class="small">Formato: Autor | Texto</div>
    <textarea id="reviews"></textarea>
  </div>

  <!-- BOTONES -->
  <div class="card">
    <button class="primary" onclick="save()">Guardar cambios</button>
    <button class="secondary" onclick="load()">Recargar</button>
    <span id="status" class="status"></span>
  </div>
</div>

<script>
async function load(){
  const res = await fetch("/site.json",{cache:"no-store"});
  const s = await res.json();

  businessName.value = s.businessName || "";
  tagline.value = s.tagline || "";
  heroTitle.value = s.heroTitle || "";
  heroSubtitle.value = s.heroSubtitle || "";

  whatsapp.value = s.contact?.whatsappNumber || "";
  phoneDisplay.value = s.contact?.phoneDisplay || "";
  instagramUrl.value = s.contact?.instagramUrl || "";

  addressLine.value = s.location?.addressLine || "";
  mapsEmbedUrl.value = s.location?.mapsEmbedUrl || "";
  mapsLinkUrl.value = s.location?.mapsLinkUrl || "";

  hoursSummary.value = s.hours?.summary || "";
  hoursLines.value = (s.hours?.lines||[])
    .map(h=>`${h.label}|${h.value}`).join("\n");

  priceRangeLine.value = s.priceRangeLine || "";

  reviews.value = (s.reviews?.items||[])
    .map(r=>`${r.author}|${r.text}`).join("\n");

  status.textContent="Datos cargados";
  status.className="status ok";
}

async function save(){
  const tokenVal = token.value.trim();
  if(!tokenVal){
    status.textContent="Falta token";
    status.className="status bad";
    return;
  }

  const body = {
    businessName: businessName.value,
    tagline: tagline.value,
    heroTitle: heroTitle.value,
    heroSubtitle: heroSubtitle.value,
    contact:{
      whatsappNumber: whatsapp.value,
      phoneDisplay: phoneDisplay.value,
      instagramUrl: instagramUrl.value
    },
    location:{
      addressLine: addressLine.value,
      mapsEmbedUrl: mapsEmbedUrl.value,
      mapsLinkUrl: mapsLinkUrl.value
    },
    hours:{
      summary: hoursSummary.value,
      lines: hoursLines.value.split("\n").filter(Boolean).map(l=>{
        const [a,b]=l.split("|"); return {label:a||"",value:b||""};
      }),
      schedule:{}
    },
    priceRangeLine: priceRangeLine.value,
    reviews:{
      title:"Reseñas",
      items: reviews.value.split("\n").filter(Boolean).map(l=>{
        const [a,b]=l.split("|"); return {author:a||"",text:b||""};
      })
    }
  };

  const res = await fetch("/api/site",{
    method:"PUT",
    headers:{
      "content-type":"application/json",
      "authorization":"Bearer "+tokenVal
    },
    body: JSON.stringify(body)
  });

  if(res.ok){
    status.textContent="Guardado correctamente ✅";
    status.className="status ok";
  }else{
    status.textContent="Error al guardar";
    status.className="status bad";
  }
}

load();
</script>
</body>
</html>
