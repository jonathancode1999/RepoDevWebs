<!doctype html>
<html lang="es-AR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin · Sitio</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#0f0f0f;
  color:#f2f2f2;
}
.wrap{max-width:900px;margin:0 auto;padding:20px}
h1{margin:0 0 10px}
h2{margin:30px 0 10px;font-size:18px}
.card{
  background:#171717;
  border:1px solid #2a2a2a;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
label{display:block;font-size:13px;color:#bbb;margin-top:10px}
input,textarea{
  width:100%;
  margin-top:4px;
  padding:10px;
  border-radius:8px;
  border:1px solid #333;
  background:#0c0c0c;
  color:#fff;
}
textarea{resize:vertical}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row > div{flex:1}
button{
  padding:12px 16px;
  border-radius:10px;
  border:0;
  background:#42d37a;
  color:#04140b;
  font-weight:800;
  cursor:pointer;
}
button.secondary{
  background:#333;
  color:#fff;
}
.status{
  margin-top:10px;
  font-size:13px;
}
.ok{color:#42d37a}
.bad{color:#ff6b6b}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>
<div class="wrap">
  <h1>Admin · Sitio</h1>
  <p class="small">Editá la información del sitio sin tocar JSON.</p>

  <div class="card">
    <label>Token de administrador</label>
    <input id="token" type="password" placeholder="Bearer token">
  </div>

  <div class="card">
    <h2>Negocio</h2>
    <label>Nombre</label><input id="businessName">
    <label>Tagline</label><input id="tagline">
    <label>Título principal</label><input id="heroTitle">
    <label>Subtítulo</label><textarea id="heroSubtitle"></textarea>
  </div>

  <div class="card">
    <h2>Contacto</h2>
    <label>WhatsApp (E164)</label><input id="whatsapp">
    <label>Teléfono visible</label><input id="phone">
    <label>Instagram URL</label><input id="instagram">
  </div>

  <div class="card">
    <h2>Ubicación</h2>
    <label>Dirección</label><input id="address">
    <label>Google Maps Embed URL</label><input id="mapsEmbed">
    <label>Google Maps Link</label><input id="mapsLink">
  </div>

  <div class="card">
    <h2>Horarios</h2>
    <label>Resumen</label><input id="hoursSummary">
  </div>

  <div class="card">
    <h2>Precio estimado</h2>
    <input id="priceRange" placeholder="$$ – $$$">
  </div>

  <div class="card">
    <h2>Reseñas (una por línea)</h2>
    <textarea id="reviews" placeholder="Ana|Excelente café ⭐⭐⭐⭐⭐"></textarea>
  </div>

  <div class="card">
    <button onclick="save()">Guardar cambios</button>
    <span id="status" class="status"></span>
  </div>
</div>

<script>
const API = "/api/site";

async function load(){
  const res = await fetch("/site.json",{cache:"no-store"});
  const s = await res.json();

  businessName.value = s.businessName || "";
  tagline.value = s.tagline || "";
  heroTitle.value = s.heroTitle || "";
  heroSubtitle.value = s.heroSubtitle || "";

  whatsapp.value = s.contact?.whatsappNumber || "";
  phone.value = s.contact?.phoneDisplay || "";
  instagram.value = s.contact?.instagramUrl || "";

  address.value = s.location?.addressLine || "";
  mapsEmbed.value = s.location?.mapsEmbedUrl || "";
  mapsLink.value = s.location?.mapsLinkUrl || "";

  hoursSummary.value = s.hours?.summary || "";
  priceRange.value = s.priceRangeLine || "";

  reviews.value = (s.reviews?.items || [])
    .map(r => `${r.author}|${r.text}`)
    .join("\n");
}

async function save(){
  const token = token.value.trim();
  if(!token){ status.textContent="Falta token"; status.className="status bad"; return; }

  const reviewsArr = reviews.value.split("\n").filter(Boolean).map(l=>{
    const [a,t] = l.split("|");
    return {author:a||"", text:t||""};
  });

  const body = {
    businessName: businessName.value,
    tagline: tagline.value,
    heroTitle: heroTitle.value,
    heroSubtitle: heroSubtitle.value,
    contact:{
      whatsappNumber: whatsapp.value,
      phoneDisplay: phone.value,
      instagramUrl: instagram.value
    },
    location:{
      addressLine: address.value,
      mapsEmbedUrl: mapsEmbed.value,
      mapsLinkUrl: mapsLink.value
    },
    hours:{ summary: hoursSummary.value, lines:[], schedule:{} },
    priceRangeLine: priceRange.value,
    reviews:{ title:"Reseñas", items: reviewsArr }
  };

  const res = await fetch(API,{
    method:"PUT",
    headers:{
      "content-type":"application/json",
      "authorization":"Bearer "+token
    },
    body: JSON.stringify(body)
  });

  if(res.ok){
    status.textContent="Guardado correctamente ✅";
    status.className="status ok";
  }else{
    status.textContent="Error al guardar";
    status.className="status bad";
  }
}

load();
</script>
</body>
</html>
