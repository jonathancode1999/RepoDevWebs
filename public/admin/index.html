<!doctype html>
<html lang="es-AR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ¬∑ Sitio y Productos</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#0f0f0f;
  color:#f2f2f2;
}
.wrap{max-width:1200px;margin:0 auto;padding:20px}
h1{margin:0}
.tabs{display:flex;gap:10px;margin:20px 0}
.tab{
  padding:10px 14px;
  border-radius:10px;
  background:#1c1c1c;
  border:1px solid #333;
  cursor:pointer;
  font-weight:800;
}
.tab.active{background:#42d37a;color:#042013}
.card{
  background:#171717;
  border:1px solid #2a2a2a;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
label{font-size:12px;color:#b8b8b8;display:block;margin-top:10px}
input,textarea{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #333;
  background:#0b0b0b;
  color:#fff;
}
textarea{resize:vertical}
button{
  padding:10px 14px;
  border-radius:10px;
  border:0;
  background:#42d37a;
  color:#042013;
  font-weight:900;
  cursor:pointer;
}
button.secondary{background:#333;color:#fff}
.list{margin-top:10px}
.list-item{
  border:1px solid #333;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
.hidden{display:none}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>
<div class="wrap">
  <h1>Admin</h1>
  <div class="small">Editar sitio y carta sin tocar JSON</div>

  <div class="card">
    <label>Token admin</label>
    <input id="token" type="password">
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('site')">üè† Sitio</div>
    <div class="tab" onclick="showTab('products')">‚òï Productos</div>
  </div>

  <!-- ================= SITIO ================= -->
  <div id="tab-site">
    <div class="card">
      <h2>Datos principales</h2>
      <label>Nombre</label><input id="businessName">
      <label>Tagline</label><input id="tagline">
      <label>T√≠tulo</label><input id="heroTitle">
      <label>Subt√≠tulo</label><textarea id="heroSubtitle"></textarea>
    </div>

    <div class="card">
      <h2>Contacto</h2>
      <label>WhatsApp</label><input id="whatsapp">
      <label>Tel√©fono visible</label><input id="phone">
      <label>Instagram</label><input id="instagram">
    </div>

    <div class="card">
      <h2>Ubicaci√≥n</h2>
      <label>Direcci√≥n</label><input id="address">
      <label>Maps embed URL</label><input id="mapsEmbed">
      <label>Maps link</label><input id="mapsLink">
    </div>

    <div class="card">
      <h2>Rese√±as</h2>
      <div id="reviews"></div>
      <button onclick="addReview()">+ Agregar rese√±a</button>
    </div>

    <div class="card">
      <button onclick="saveSite()">Guardar sitio</button>
      <span id="siteStatus" class="small"></span>
    </div>
  </div>

  <!-- ================= PRODUCTS ================= -->
  <div id="tab-products" class="hidden">
    <div class="card">
      <h2>Categor√≠as</h2>
      <div id="categories"></div>
      <button onclick="addCategory()">+ Agregar categor√≠a</button>
    </div>

    <div class="card">
      <button onclick="saveProducts()">Guardar productos</button>
      <span id="prodStatus" class="small"></span>
    </div>
  </div>
</div>

<script>
let SITE={}, PRODUCTS={};

function showTab(t){
  document.getElementById("tab-site").classList.toggle("hidden",t!=="site");
  document.getElementById("tab-products").classList.toggle("hidden",t!=="products");
  document.querySelectorAll(".tab").forEach(el=>el.classList.remove("active"));
  document.querySelector(".tab[onclick*='"+t+"']").classList.add("active");
}

async function load(){
  SITE = await (await fetch("/site.json",{cache:"no-store"})).json();
  PRODUCTS = await (await fetch("/products.json",{cache:"no-store"})).json();

  businessName.value = SITE.businessName||"";
  tagline.value = SITE.tagline||"";
  heroTitle.value = SITE.heroTitle||"";
  heroSubtitle.value = SITE.heroSubtitle||"";

  whatsapp.value = SITE.contact?.whatsappNumber||"";
  phone.value = SITE.contact?.phoneDisplay||"";
  instagram.value = SITE.contact?.instagramUrl||"";

  address.value = SITE.location?.addressLine||"";
  mapsEmbed.value = SITE.location?.mapsEmbedUrl||"";
  mapsLink.value = SITE.location?.mapsLinkUrl||"";

  renderReviews();
  renderCategories();
}

function renderReviews(){
  const c=document.getElementById("reviews"); c.innerHTML="";
  (SITE.reviews?.items||[]).forEach((r,i)=>{
    const d=document.createElement("div"); d.className="list-item";
    d.innerHTML=`
      <label>Autor</label><input value="${r.author||""}" onchange="SITE.reviews.items[${i}].author=this.value">
      <label>Texto</label><textarea onchange="SITE.reviews.items[${i}].text=this.value">${r.text||""}</textarea>
      <button class="secondary" onclick="SITE.reviews.items.splice(${i},1);renderReviews()">Eliminar</button>`;
    c.appendChild(d);
  });
}

function addReview(){
  SITE.reviews.items.push({author:"",text:""});
  renderReviews();
}

function renderCategories(){
  const c=document.getElementById("categories"); c.innerHTML="";
  PRODUCTS.categories.forEach((cat,ci)=>{
    const d=document.createElement("div"); d.className="list-item";
    d.innerHTML=`<label>Categor√≠a</label>
      <input value="${cat.category}" onchange="PRODUCTS.categories[${ci}].category=this.value">`;
    cat.items.forEach((it,ii)=>{
      d.innerHTML+=`
        <div class="list-item">
          <input placeholder="Nombre" value="${it.name}" onchange="PRODUCTS.categories[${ci}].items[${ii}].name=this.value">
          <input placeholder="Descripci√≥n" value="${it.description}" onchange="PRODUCTS.categories[${ci}].items[${ii}].description=this.value">
          <input placeholder="Precio" value="${it.price}" onchange="PRODUCTS.categories[${ci}].items[${ii}].price=this.value">
        </div>`;
    });
    d.innerHTML+=`<button onclick="PRODUCTS.categories[${ci}].items.push({name:'',description:'',price:''});renderCategories()">+ Item</button>`;
    c.appendChild(d);
  });
}

async function saveSite(){
  const t=token.value.trim();
  const res=await fetch("/api/site",{method:"PUT",headers:{
    "content-type":"application/json",
    "authorization":"Bearer "+t
  },body:JSON.stringify(SITE)});
  siteStatus.textContent=res.ok?"Guardado ‚úÖ":"Error";
}

async function saveProducts(){
  const t=token.value.trim();
  const res=await fetch("/api/products",{method:"PUT",headers:{
    "content-type":"application/json",
    "authorization":"Bearer "+t
  },body:JSON.stringify(PRODUCTS)});
  prodStatus.textContent=res.ok?"Guardado ‚úÖ":"Error";
}

load();
</script>
</body>
</html>
